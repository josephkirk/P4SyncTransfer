{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "P4Sync Configuration Schema",
  "description": "JSON schema for P4Sync configuration files",
  "version": "2.0.0",
  "type": "object",
  "properties": {
    "Filters": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Global filters to apply"
    },
    "SyncProfiles": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SyncProfile"
      },
      "description": "List of sync profiles"
    },
    "Logging": {
      "$ref": "#/definitions/LoggingConfiguration",
      "description": "Logging configuration"
    }
  },
  "additionalProperties": false,
  "definitions": {
    "SyncProfile": {
      "type": "object",
      "properties": {
        "Name": {
          "type": "string",
          "description": "Name of the sync profile"
        },
        "Source": {
          "$ref": "#/definitions/P4Connection",
          "description": "Source Perforce connection"
        },
        "Target": {
          "$ref": "#/definitions/P4Connection",
          "description": "Target Perforce connection"
        },
        "SyncFilter": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^//[^/]+/.*",
            "examples": [
              "//depot/main/...txt",
              "//depot/projects/...cs",
              "//depot/docs/...md",
              "//depot/main/src/...*",
              "//depot/binaries/...exe"
            ]
          },
          "description": "Array of Perforce filespec patterns for filtering files during synchronization. Patterns must start with '//depot/' and can include wildcards like '...' for recursive matching and '*' for file name matching. Examples: '//depot/main/...txt' matches all .txt files recursively, '//depot/src/...*.cs' matches all .cs files in src directory tree.",
          "minItems": 1
        },
        "Schedule": {
          "type": "string",
          "description": "Cron schedule for automatic sync"
        },
        "AutoSubmit": {
          "type": "boolean",
          "description": "Automatically submit changelists after sync operations. When enabled, all file operations (add/edit/delete) will be automatically submitted with descriptive changelist messages. Default is false for safety.",
          "default": false,
          "examples": [true, false]
        },
        "Description": {
          "type": "string",
          "description": "Custom description for changelists created during sync operations. Supports keyword replacement: {source_server}, {source_workspace}, {target_server}, {target_workspace}, {profile_name}, and {now} (current timestamp). If not specified, defaults to '[Auto] P4 Sync Transfer from {source_server} {source_workspace}'.",
          "examples": [
            "[Auto] P4 Sync Transfer from {source_server} {source_workspace}",
            "Daily sync from {source_workspace} to production - {now}",
            "Feature branch merge: {source_workspace} - {now}",
            "{profile_name} sync completed at {now}"
          ]
        },
        "MaxDegreeOfParallelism": {
          "type": "integer",
          "description": "Maximum number of parallel threads for processing files. Higher values can improve performance on multi-core systems but increase memory and network usage. Default is 4.",
          "default": 4,
          "minimum": 1,
          "maximum": 32,
          "examples": [1, 2, 4, 8, 16]
        },
        "BatchSize": {
          "type": "integer",
          "description": "Number of files to process in each batch. Larger batches can improve performance but increase memory usage. Default is 100.",
          "default": 100,
          "minimum": 1,
          "maximum": 1000,
          "examples": [10, 50, 100, 200, 500]
        },
        "UseDigestComparison": {
          "type": "boolean",
          "description": "Use Perforce file digest (MD5) for comparison instead of downloading and comparing files. This dramatically improves performance by avoiding unnecessary file I/O. Default is true.",
          "default": true,
          "examples": [true, false]
        },
        "EnableInMemoryHistoryCache": {
          "type": "boolean",
          "description": "Cache sync history in memory to avoid repeated disk reads. This improves performance by eliminating thousands of disk I/O operations. Default is true.",
          "default": true,
          "examples": [true, false]
        },
        "HistoryCacheSizeMB": {
          "type": "integer",
          "description": "Maximum size of the history cache in megabytes. Larger caches can improve performance for large sync operations but consume more memory. Default is 100 MB.",
          "default": 100,
          "minimum": 10,
          "maximum": 1000,
          "examples": [50, 100, 200, 500]
        }
      },
      "required": ["Name", "Source", "Target"],
      "additionalProperties": false
    },
    "P4Connection": {
      "type": "object",
      "properties": {
        "Port": {
          "type": "string",
          "description": "Perforce server port"
        },
        "User": {
          "type": "string",
          "description": "Perforce username"
        },
        "Workspace": {
          "type": "string",
          "description": "Perforce workspace/client name"
        }
      },
      "required": ["Port", "User", "Workspace"],
      "additionalProperties": false
    },
    "LoggingConfiguration": {
      "type": "object",
      "properties": {
        "LogLevel": {
          "type": "object",
          "properties": {
            "Default": {
              "type": "string",
              "enum": ["Trace", "Debug", "Information", "Warning", "Error", "Critical"]
            }
          },
          "additionalProperties": {
            "type": "string",
            "enum": ["Trace", "Debug", "Information", "Warning", "Error", "Critical"]
          }
        },
        "Console": {
          "type": "object",
          "properties": {
            "FormatterName": {
              "type": "string"
            },
            "IncludeScopes": {
              "type": "boolean"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  }
}