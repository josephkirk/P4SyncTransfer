{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "P4Sync Configuration Schema",
  "description": "JSON schema for P4Sync configuration files",
  "version": "2.0.0",
  "type": "object",
  "properties": {
    "UseExternalP4": {
      "type": "boolean",
      "description": "Whether to use external p4.exe instead of embedded P4 library. External mode provides better performance and compatibility with complex Perforce configurations but requires p4.exe to be installed. Embedded mode offers better portability but may have limitations with advanced Perforce features.",
      "default": true,
      "examples": [true, false]
    },
    "Filters": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Global filters to apply"
    },
    "SyncProfiles": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SyncProfile"
      },
      "description": "List of sync profiles"
    },
    "Logging": {
      "$ref": "#/definitions/LoggingConfiguration",
      "description": "Logging configuration"
    }
  },
  "additionalProperties": false,
  "definitions": {
    "SyncProfile": {
      "type": "object",
      "properties": {
        "Name": {
          "type": "string",
          "description": "Name of the sync profile"
        },
        "Source": {
          "$ref": "#/definitions/P4Connection",
          "description": "Source Perforce connection"
        },
        "Target": {
          "$ref": "#/definitions/P4Connection",
          "description": "Target Perforce connection"
        },
        "SyncFilter": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^//[^/]+/.*",
            "examples": [
              "//depot/main/...txt",
              "//depot/projects/...cs",
              "//depot/docs/...md",
              "//depot/main/src/...*",
              "//depot/binaries/...exe"
            ]
          },
          "description": "Array of Perforce filespec patterns for filtering files during synchronization. Patterns must start with '//depot/' and can include wildcards like '...' for recursive matching and '*' for file name matching. Examples: '//depot/main/...txt' matches all .txt files recursively, '//depot/src/...*.cs' matches all .cs files in src directory tree.",
          "minItems": 1
        },
        "Schedule": {
          "type": "string",
          "description": "Cron schedule for automatic sync"
        },
        "AutoSubmit": {
          "type": "boolean",
          "description": "Automatically submit changelists after sync operations. When enabled, all file operations (add/edit/delete) will be automatically submitted with descriptive changelist messages. Default is false for safety.",
          "default": false,
          "examples": [true, false]
        },
        "UseExternalP4": {
          "type": "boolean",
          "description": "Override the global UseExternalP4 setting for this specific profile. Allows different profiles to use different P4 operation modes.",
          "examples": [true, false]
        },
        "Description": {
          "type": "string",
          "description": "Custom description for changelists created during sync operations. Supports keyword replacement: {source_server}, {source_workspace}, {target_server}, {target_workspace}, {profile_name}, and {now} (current timestamp). If not specified, defaults to '[Auto] P4 Sync Transfer from {source_server} {source_workspace}'.",
          "examples": [
            "[Auto] P4 Sync Transfer from {source_server} {source_workspace}",
            "Daily sync from {source_workspace} to production - {now}",
            "Feature branch merge: {source_workspace} - {now}",
            "{profile_name} sync completed at {now}"
          ]
        }
      },
      "required": ["Name", "Source", "Target"],
      "additionalProperties": false
    },
    "P4Connection": {
      "type": "object",
      "properties": {
        "Port": {
          "type": "string",
          "description": "Perforce server port"
        },
        "User": {
          "type": "string",
          "description": "Perforce username"
        },
        "Workspace": {
          "type": "string",
          "description": "Perforce workspace/client name"
        }
      },
      "required": ["Port", "User", "Workspace"],
      "additionalProperties": false
    },
    "LoggingConfiguration": {
      "type": "object",
      "properties": {
        "LogLevel": {
          "type": "object",
          "properties": {
            "Default": {
              "type": "string",
              "enum": ["Trace", "Debug", "Information", "Warning", "Error", "Critical"]
            }
          },
          "additionalProperties": {
            "type": "string",
            "enum": ["Trace", "Debug", "Information", "Warning", "Error", "Critical"]
          }
        },
        "Console": {
          "type": "object",
          "properties": {
            "FormatterName": {
              "type": "string"
            },
            "IncludeScopes": {
              "type": "boolean"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  }
}